Месье Бэзликов, [9/24/2022 3:58 PM]
условие: https://contest.yandex.ru/contest/28069/problems/A
мой код: 

```objectivec
#include <iostream>
#include <algorithm>
#include <unordered_set>

using namespace std;

struct TreeNode {
    int val; // Опциональное поле для хранения значения
    TreeNode* left;
    TreeNode* right;
};

void Node_Add(TreeNode*& p, int x);
void Node_Clear(TreeNode*& p);
int  Node_Height(TreeNode*& root); // why Node_Height(const Node*& root) // error?!

int main() {
    
    TreeNode* tr = nullptr;
    int x;
    cin >> x;

    unordered_set <int> leaflets = {x};
    int size_leaflets = -1;
    while (x != 0) {
        // Если элемент уже существует в дереве, добавлять его не надо.
        if (leaflets.size() != size_leaflets) {
            size_leaflets = leaflets.size();
            Node_Add(tr, x);
        }
        
        cin >> x;
        leaflets.insert(x);
    }
        
    cout << Node_Height(tr);
    Node_Clear(tr); // это точно нужно?

    return 0;
}

//вставка
void Node_Add(TreeNode*& p, int x) { // Node*& == auto и узнать тип auto
    if (p == nullptr) {
        p = new  TreeNode;
        if (p != nullptr) {
            p->left = p->right = nullptr;
            p->val = x;
        }
    }
    else if (x < p->val)
        Node_Add(p->left, x);
    else
        Node_Add(p->right, x);
}

//удаление всех
void Node_Clear(TreeNode*& p) {
    if (p != nullptr) {
        if (p->left != nullptr) {
            Node_Clear(p->left);
        }
        if (p->right != nullptr) {
            Node_Clear(p->right);
        }
        delete p;
    }
}

//высота дерева
int  Node_Height(TreeNode*& root) {
    if (!root) { return 0; }
    int max_height_left = Node_Height(root->left);
    int max_height_right = Node_Height(root->right);
    return  max(max_height_left, max_height_right) + 1;

}
```

Помогите пожал-а с...
Вопросы:

1. достойный ли код по качеству? Если нет — как улучшить?
2. почему в 15 строке нельзя сделать константную ссылку?
3. нужна ли функция  Node_Clear(tr)?

blue, [9/24/2022 4:11 PM]
[In reply to Месье Бэзликов]
задачу не смотрел, так как не могу, код бегло глянул
2. в данном случае ссылка там вообще не нужна, она наоборот твой код делает медленнее за счет дополнительного скрытого разыменовывания конкретно в данном случае
3. нужна, память сама себя не высвободит же

Месье Бэзликов, [9/24/2022 4:12 PM]
[In reply to blue]
"3. нужна, память сама себя не высвободит же" — но ведь сразу после этого код оканчивается, тогда и память освобождается, не?)

blue, [9/24/2022 4:12 PM]
Да, но что если бы этот код был частью какого-то проекта где это не было бы кейсом?

Месье Бэзликов, [9/24/2022 4:14 PM]
[In reply to blue]
вот я примерно так и думал, хотел подтверждение свой мысли, поэтому и оставил этот фрагмент, спасибо)

Месье Бэзликов, [9/24/2022 4:14 PM]
а вот за пункт 2 — не понял

blue, [9/24/2022 4:14 PM]
тогда ты бы получил утечку памяти, и если бы подобный код допускающий утечку вызывался бы часто, то через какой-то относительно небольшой промежуток времени ты бы либо получил краш (например если это x86-32 приложение которое умеет работать только с памятью в пределах 4-х гб), либо если система свапает на диск, то всё начнет очень сильно тупить

Месье Бэзликов, [9/24/2022 4:15 PM]
как по мне, ссылка же априори ускоряет выполгение проргаммы, не?

blue, [9/24/2022 4:15 PM]
нет, вообще тут немного базы бы не помешало, если упрощать и откинуть синтаксический сахар, то ссылка это такой же поинтер

blue, [9/24/2022 4:16 PM]
то есть в данном случае после компиляции мы получаем TreeNode** p, и как следствие скрытое разыменовывание

Месье Бэзликов, [9/24/2022 4:17 PM]
[In reply to blue]
получается, ссылку с указателя лучше вообще не использовать?

blue, [9/24/2022 4:17 PM]
это зависит от ситуации, если тебе не нужно модифицировать изначальный поинтер там, откуда ты его передаешь, то тогда да, это просто не имеет смысла

blue, [9/24/2022 4:19 PM]
тут уже мы плавно подходим к тому что такое lvalue и rvalue, ну rvalue ещё обычно делят на prvalue и xvalue, но туда углубляться не буду, если просто, то у тебя по факту lvalue refence, причем сам lvalue является указателем на объект, ты его не модифицируешь, поэтому передавать реф на него нет смысла

blue, [9/24/2022 4:20 PM]
ты работаешь с объектом на который указывает указатель, а не с самим указателем :)
